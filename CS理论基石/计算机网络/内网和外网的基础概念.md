## 关于内网和外网

网上经常看到有人问内网和外网的区别，其实外网和内网的概念很模糊，全看你怎么理解。希望这篇文章能帮助大家明确一些概念。

简单的说，自己的单位或者家庭、小区内部有局域网；单位、家庭之外有覆盖范围极大的网络，比如internet，这个大网络延伸到了我们的单位、家庭（通过光纤、网线、电话线等）。我们把自己的局域网连接到internet上，那么我们的访问范围就从局域网扩展到了整个internet。这时候，就说局域网是内网，internet是外网。

同理，如果你们单位的局域网很庞大，而你的办公室里面的几台电脑组成的小局域网又连接到单位的整个大局域网，那么也可以说单位的大局域网是外网，办公室内的小局域网是内网。同时，如果单位的大局域网连接了Internet，那么相对于Internet，也可以说单位的大局域网是内网。

内网可能是一个独立的局域网，通过其中的网关（网关就是连接两个网络的节点，说白了，就是有双重身份的电脑，既有局域网的IP地址，又有Internet的IP地址，两个IP地址分别捆绑在不同的网卡上）的代理访问外部网络，比如网吧都是这样实现的，其特征是：网吧内的电脑的ip都是局域网专用ip，[比如192.168.xxx.xxx或者10.xxx.xxx.xxx](http://xn--192-eo8er22f.168.xxx.xn--xxx10-zm6jl44o.xxx.xxx.xxx/)，而这种ip在internet上面是不会出现的。

（注：所谓代理，就是你提要求，他来办事，类似于代购火车票。局域网的电脑想和外面联络，就把对方地址告诉服务器，也就是网关，网关以自己的身份和对方联络，同时把对方发回来的消息转送给局域网内的电脑。因此，对方看不见局域网内电脑的IP，只会以为是网关那台电脑在与自己交流。网吧内的所有QQ都显示同样的IP，现在你能理解为什么了吗？）

内网也可能是外网的一个部分，比如校园网，或者相对于单位局域网的办公室内部局域网。其特征是：内网电脑的ip就是整个外网ip范围的一部分，内网的电脑通过网关（路由器）连接到外网，网关不需要进行代理服务，直接路由就行了。

（注：所谓路由，就是路径选择。路由器连接多个网络，因此一定是各个网络的网关，其作用类似于邮局。你想联系局域网外的电脑，就把邮包发送给路由器，路由器会帮你投递到邮包上标明的地址。这样，收到邮包的人可以知道是谁把邮包发过来的，但是，他无法知道发邮包的人是不是帮别人代理发邮包的。或者说，收到数据的电脑可以知道是哪台电脑在与它联络，但它无法知道与它联络的这台电脑是否是某个局域网的代理服务器。）
广域网上的每一台电脑（或其他网络设备）都有一个或多个广域网IP地址（或者说公网、外网IP地址），广域网IP地址一般要到ISP处交费之后才能申请到，广域网IP地址不能重复；局域网（LAN）上的每一台电脑（或其他网络设备）都有一个或多个局域网IP地址（或者说私网、内网IP地址），局域网IP地址是局域网内部分配的，不同局域网的IP地址可以重复，不会相互影响。

广域网（WAN、公网、外网）与局域网（LAN、私网、内网）电脑交换数据要通过路由器或网关的NAT（网络地址转换）进行。一般说来，局域网（LAN、私网、内网）内电脑发起的对外连接请求，路由器或网关都不会加以阻拦，但来自广域网对局域网内电脑电脑连接的请求，路由器或网关在绝大多数情况下都会进行拦截。
通常情况下，网关或路由器对内部向外发出的信息不会进行拦截，但对来自外部想进入内部网络的信息则会进行识别、筛选，认为是安全的、有效的，才会转发给内网电脑。正是这种情况的存在，才导致了很多内网用户没有“远程”，速度也不尽如人意。

电脑通过ip地址来连接网络，IP（我们常常称为IP地址）的总量是有限的，第一批公网IP的数量就更少了，到目前为止接近枯竭。注意：每台设备都一个物理地址（电脑和手机），这个地址标志着设备的物理唯一性，每台连入了网络的设备都有一个IP，标志着它在网络中的唯一性。

**所以你的电脑是怎么获得IP的呢？**

首先你要相信一个事实，你自己拉的宽带不太可能是公网IP（它已经接近枯竭），所以你的宽带也是内网IP，内网IP分为两种，一种是相对固定的IP(自己家的电脑IP几乎不会变),第二种是wifi 下的电脑，在一定的IP范围内随机分配IP。IP分配的手段是通过路由器和转换器（不是必须的）转化的。家庭的宽带就是一个外网IP经过路由器分成多个内网IP，所以一个网线多个人家共用和一个网线供多个电脑工作是一个意思，这里我们就不得不说网速的问题了，宽带的规则是按需分配，数据的在网络中的传递一般都是多线程（例如三个任务，交替执行但是每个任务执行0.001s，时间短我们几乎看不见项目的交替），所以同一个局域网下，我的网速快你的网速就很卡了，办理宽带的时候说的是20M/s,办理下来就真的不一定了。

从一个公司的角度来看：一个公司是一个局域网（物理空间上的局域），里面有数十上百台电脑，这个电脑阵列同时上网，必定是有着不同的IP，差别仅限于192.168.10.226和192.168.10.225（只是举一个例子），这些IP称为内网IP，他们所组成的局域网可以堪称是一台电脑堡垒机，这台堡垒机拥有着一个IP,这个IP称为公网IP(外网IP).

从网络的角度来看，所有的能连上网络的电脑，相互之间通信构成了网络世界，每台电脑都有一个网络世界的名字，这个名字就是IP，或者说是外网IP（局域网的情况下这么称呼）。每台电脑都可以选择自己的命运是称为服务器还是客户端。在这里要明白：所谓服务器就是一台开启了对外服务接口和端口的性能比较优越的电脑,所以原则上你手中的电脑也可以称为服务器。

**那么问题来了，就是为什么我的电脑不能被外界访问呢？**

这个地方就涉及到了编程的知识，和内网外网的区别了，普通电脑想要升华成服务器必备三个条件：

1.搭建服务，并启动服务，简单的就是tomcat，mysql之类，redis，zookeeper，kafka ,nginx,docker,redis 等等

2.提供对外接口和端口，要知道浏览器之所以能访问成功，本质是后台做了路由。例如地址“https://mp.csdn.net/postedit”，在浏览器输入后，其实代码中会先定位到服务器的IP和提供该服务的端口号，例如“192.168.1.10：7070”，“/postedit”则是代码中的接口，该接口返回你所需要的数据，通过页面跳转展示出你看到的结果。

3.规则：外网IP才能被访问到，内网IP，只能被处于同一内网的设备访问。

下面来说说VPN,它的两个作用，一种是翻墙到国外网站（一切被我们国家墙掉的网站都称为国外网站），一种是企业，学校，机关部门的VPN。说说第二种VPN，因为局域网不被外部访问，所以很好的保护了企业内部的安全，局域网又具备一定的地理局限性，所以一个企业的没有分公司都是一个局域网，然而公司的内部资料只能放在一个地方，所以其他子公司想访问就属于跨域（局域网）访问，VPN 一定是子母共存的，我们用的子VPN,将我们的请求打包转换重定位到母VPN,再解析成我们的原始请求。

通常来说，局域网是属于链路层的，也就是说，通过交换机就能够搭建起一个简单的局域网，在这个局域网内通信，我们称为内网通信。

**那么如何判断是否在一个局域网内呢？**

功臣tcp/ip协议的网际层的ip协议为每个电脑都分配了一个ip地址，我们可以通过ip地址与子网掩码进行运算，得出的结果相同，就证明在一个局域网内，需要明确的是，局域网内是可以直接通信的，因为局域网属于第二层，不需要经过网络层转发数据包。
**什么是内网ip**

ipv4是目前比较广泛使用的一个版本，它是由32位二进制数组成的，但是ip毕竟是有限的，随着计算机的爆炸性增长和移动网络的普及，ip地址越来越不够用，于是出现了一门技术叫NAT技术，NAT（Network Address Translation）网络地址转换，就是替换ip报文头部的地址信息。NAT通常部署在一个组织的网络出口位置，通过将内部网络IP地址替换为出口的IP地址提供公网可达性和上层协议的连接能力。那么，什么是内部网络IP地址？
RFC1918规定了三个保留地址段落：10.0.0.0-10.255.255.255；172.16.0.0-172.31.255.255；192.168.0.0-192.168.255.255。这三个范围分别处于A,B,C类的地址段，不向特定的用户分配，被IANA作为私有地址保留。这些地址可以在任何组织或企业内部使用，和其他Internet地址的区别就是，仅能在内部使用，不能作为全球路由地址。这就是说，出了组织的管理范围这些地址就不再有意义，无论是作为源地址，还是目的地址。对于一个封闭的组织，如果其网络不连接到Internet，就可以使用这些地址而不用向IANA提出申请，而在内部的路由管理和报文传递方式与其他网络没有差异。

简单的来讲，计算机在内网会获得一个ip地址，这个地址被称作内网ip，它仅仅是在内网内不能重复，当内网的一台计算机想要跟外网通信的时候，需要通过NAT做ip转换，也就是把计算机的内网ip转换为外网ip。这样可以大大的缓解ip数量危机。
**内网ip和外网ip的联系以及连接过程**
![在这里插入图片描述](./assets/%E5%86%85%E7%BD%91%E5%92%8C%E5%A4%96%E7%BD%91%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzgwMzA3MA==,size_16,color_FFFFFF,t_70.png)如图，假设我们的计算机现在就是设备一，我们想要访问百度。如果我们正使用着校园网，那么首先我们需要先通过校园网的路由器把我们的内网ip转为校园网的外网ip。然后通过这个外网ip先连接上湖南电信的网关，最后在连接上百度的网关。百度把你请求的信息回传到你的校园网网关，校园网网关再把信息传给你（整个网络呈网状结构，它会自动找到一条通往百度的路径——基于深度优先搜索或者广度优先搜索)。