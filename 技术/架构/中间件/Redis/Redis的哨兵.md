# 哨兵

## 主从复制的问题

* 高可用问题

  一旦主节点出现故障，需要手动将一个从节点晋升为主节点，同时需 要通知应用方修改主节点地址，还需要命令其他从节点去复制新的主节点，整个过程都需要人工干预。

  上述过程，就是一个Redis的**故障转移**操作。但是由于整个故障转移过程都需要人工干预，而人工干预的准确性、实时性都不可控，因此可以说人工的故障转移是Redis的一个非高可用问题。

* 分布式问题
  * 主节点的写能力受到单机的限制；
  * 主节点的存储能力受到单机的限制。



## Redis Sentinel的高维度认知

Redis Sentinel是一个**分布式架构**，它的Redis数据节点、Sentinel节点集合、客户端分布在多个物理节点，他是Redis官方提供的解决Redis高可用问题的一个解决方案。



Redis Sentinel的主要组成包含：

* 若干个Sentinel节点；
* Redis 数据节点。



从一个比较高的层次来看，他的高可用流程为：

1. 主从节点失去连接，主从复制失败；
2. 每个Sentinel节点会对数据节点和其余Sentinel节点进行监控，当它发现节点不可达时，会对节点做下线标识;
3. 如果被标识的是主节点，它还会和其他Sentinel节点进行“协商”，当大多数Sentinel节点都认为主节点不可达时，它们会选举出一个Sentinel节点来完成**自动故障转移**的工作;
4. 将这个变化实时通知给Redis应用方。

整个过程完全是自动的，不需要人工来介入，所以这套方案很有效地解决了Redis的高可用问题。

这里遗留一个问题：发现从结点不可达了会怎么处理呢。

答：发现从结点不可用，就直接让从结点客观下限，没有什么其他的操作。



>  Redis Sentinel用于解决Redis的高可用问题，他提供了：
>
> * 准确的判断节点不可达的机制；
> * 如果有多个从节点，保证只有一个被晋升为主节点；
> * 一个健壮的通知客户端新的主节点机制。
>
> 当主节点出现故障时，Redis Sentinel能**自动完成故障发现和故障转移，并通知应用方**，从而实现真正的高可用。





Redis Sentinel与Redis主从复制模式的区别如下：

<img src="Redis的哨兵.assets/image-20220621162031422.png" alt="image-20220621162031422" style="zoom: 67%;" />

只是多了若干Sentinel节点。



Redis Sentinel具有以下几个功能：

* 监控

* 通知

* 主节点故障转移

* 配置提供者

  在Redis Sentinel结构中，客户端在初始化的时候连接的是Sentinel节点集合，从中获取主节点信息。



Rdis Sentinel包含了若干个Sentinel节点，具备如下好处：

* 防误判
* 保证Sentinel节点结合的健壮性

Sentinel节点本身就是独立的Redis节点，只不过它们有一些特殊， 它们不存储数据，只支持部分命令。



## Redis Sentinel相关配置

详情查看文档即可，不做记录。















