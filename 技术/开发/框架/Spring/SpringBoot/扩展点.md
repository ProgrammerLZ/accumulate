ç†è§£ Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­ **æ‰€æœ‰æ‰©å±•ç‚¹çš„æ‰§è¡Œé¡ºåº**ï¼Œå¯¹äºæŒæ¡æ¡†æ¶åŸç†ã€è‡ªå®šä¹‰å¯åŠ¨é€»è¾‘ã€è°ƒè¯•é—®é¢˜éƒ½è‡³å…³é‡è¦ã€‚

ä»¥ä¸‹ **å®Œæ•´ã€å‡†ç¡®ã€æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„ Spring Boot å¯åŠ¨æ‰©å±•ç‚¹åˆ—è¡¨**ï¼Œé€‚ç”¨äº **Spring Boot 2.7+ / 3.x** ç‰ˆæœ¬ã€‚

---

## ğŸš€ Spring Boot å¯åŠ¨æ‰©å±•ç‚¹æ‰§è¡Œé¡ºåºï¼ˆä»æ—©åˆ°æ™šï¼‰

| é˜¶æ®µ | æ‰©å±•ç‚¹                                                       | è§¦å‘æ—¶æœº                                              | è¯´æ˜                                              |
| ---- | ------------------------------------------------------------ | ----------------------------------------------------- | ------------------------------------------------- |
| 1ï¸âƒ£    | `SpringApplicationRunListener` æ„é€ å‡½æ•°                      | `new SpringApplication()` æ—¶                          | æœ€æ—©çš„åˆ‡å…¥ç‚¹ï¼Œç”¨äºç›‘å¬æ•´ä¸ªå¯åŠ¨è¿‡ç¨‹                |
| 2ï¸âƒ£    | `SpringApplicationRunListener.starting()`                    | `run()` æ–¹æ³•å¼€å§‹æ‰§è¡Œ                                  | æ­¤æ—¶ `ApplicationArguments` è¿˜æœªåˆ›å»º              |
| 3ï¸âƒ£    | `ApplicationContextInitializer`                              | `prepareContext()` ä¹‹å‰                               | å¯ä¿®æ”¹ `Environment`ã€æ·»åŠ  `PropertySource` ç­‰    |
| 4ï¸âƒ£    | `SpringApplicationRunListener.environmentPrepared()`         | `Environment` åˆ›å»ºå¹¶åŠ è½½å                            | å¯è¯»å–é…ç½®ã€ä¿®æ”¹ `PropertySource`ã€è®¾ç½® profile   |
| 5ï¸âƒ£    | `ApplicationListener<ApplicationEnvironmentPreparedEvent>`   | åŒä¸Šï¼Œäº‹ä»¶é©±åŠ¨æ–¹å¼                                    | ä¸ `environmentPrepared` ç­‰ä»·ï¼Œä½†åŸºäºäº‹ä»¶         |
| 6ï¸âƒ£    | `EnvironmentPostProcessor`                                   | `environmentPrepared` ä¹‹å                            | ä¸“é—¨ç”¨äº **å¤„ç† `Environment`**ï¼Œæ”¯æŒ `@Order`    |
| 7ï¸âƒ£    | `SpringApplicationRunListener.contextPrepared()`             | `ApplicationContext` åˆ›å»ºåï¼Œä½†å°šæœªåŠ è½½ Bean          | æ­¤æ—¶ä¸Šä¸‹æ–‡å·²åˆ›å»ºï¼Œä½† `refresh()` è¿˜æœªè°ƒç”¨         |
| 8ï¸âƒ£    | `ApplicationListener<ApplicationContextInitializedEvent>`    | åŒä¸Šï¼Œäº‹ä»¶é©±åŠ¨æ–¹å¼                                    | åŸºäºäº‹ä»¶çš„ `contextPrepared`                      |
| 9ï¸âƒ£    | `ApplicationContextAware` / `EnvironmentAware` ç­‰ `Aware` æ¥å£å›è°ƒ | Bean å®ä¾‹åŒ–è¿‡ç¨‹ä¸­                                     | å½“ Bean å®ç°äº†è¿™äº›æ¥å£ï¼ŒSpring ä¼šè‡ªåŠ¨æ³¨å…¥å¯¹åº”å¯¹è±¡ |
| ğŸ”Ÿ    | `BeanFactoryPostProcessor` / `BeanDefinitionRegistryPostProcessor` | `refresh()` é˜¶æ®µï¼Œ`invokeBeanFactoryPostProcessors()` | å¯ä¿®æ”¹ Bean å®šä¹‰ï¼ˆå¦‚å±æ€§ã€ä½œç”¨åŸŸã€å®šä¹‰æœ¬èº«ï¼‰      |
| 1ï¸âƒ£1ï¸âƒ£   | `@Configuration` ç±»ä¸­çš„ `@Bean` æ–¹æ³•æ‰§è¡Œ                     | `refresh()` é˜¶æ®µ                                      | æŒ‰é…ç½®ç±»é¡ºåºåˆ›å»º Bean å®ä¾‹                        |
| 1ï¸âƒ£2ï¸âƒ£   | `BeanPostProcessor.postProcessBeforeInitialization()`        | Bean åˆå§‹åŒ–å‰ï¼ˆ`@PostConstruct` å‰ï¼‰                  | å¯å¯¹ Bean è¿›è¡Œä»£ç†ã€åŒ…è£…ç­‰æ“ä½œ                    |
| 1ï¸âƒ£3ï¸âƒ£   | `@PostConstruct` / `InitializingBean.afterPropertiesSet()`   | Bean åˆå§‹åŒ–é˜¶æ®µ                                       | æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘                                    |
| 1ï¸âƒ£4ï¸âƒ£   | `BeanPostProcessor.postProcessAfterInitialization()`         | Bean åˆå§‹åŒ–åï¼ˆ`@PostConstruct` åï¼‰                  | AOP ä»£ç†é€šå¸¸åœ¨è¿™é‡Œç”Ÿæˆ                            |
| 1ï¸âƒ£5ï¸âƒ£   | `ApplicationRunner` / `CommandLineRunner`                    | `refresh()` å®Œæˆåï¼Œåº”ç”¨å¯åŠ¨å®Œæˆå‰                    | ç”¨äºæ‰§è¡Œå¯åŠ¨åé€»è¾‘ï¼ˆå¦‚æ•°æ®åˆå§‹åŒ–ï¼‰                |
| 1ï¸âƒ£6ï¸âƒ£   | `SpringApplicationRunListener.started()`                     | æ‰€æœ‰ Runner æ‰§è¡Œå®Œå                                  | åº”ç”¨å·²å¯åŠ¨ï¼Œå¯ä»¥æ¥æ”¶è¯·æ±‚                          |
| 1ï¸âƒ£7ï¸âƒ£   | `ApplicationListener<ApplicationStartedEvent>`               | åŒä¸Šï¼Œäº‹ä»¶é©±åŠ¨æ–¹å¼                                    | äº‹ä»¶æ–¹å¼ç›‘å¬å¯åŠ¨å®Œæˆ                              |
| 1ï¸âƒ£8ï¸âƒ£   | Web Server å¯åŠ¨å®Œæˆï¼ˆå¦‚ Tomcatï¼‰                             | `started()` ä¹‹å                                      | ç«¯å£å·²ç»‘å®šï¼Œå¯æ¥æ”¶ HTTP è¯·æ±‚                      |
| 1ï¸âƒ£9ï¸âƒ£   | `SpringApplicationRunListener.ready()`                       | åº”ç”¨å®Œå…¨å°±ç»ª                                          | Spring Boot å¯åŠ¨æµç¨‹ç»“æŸ                          |
| 2ï¸âƒ£0ï¸âƒ£   | `ApplicationListener<ApplicationReadyEvent>`                 | åŒä¸Šï¼Œäº‹ä»¶é©±åŠ¨æ–¹å¼                                    | æ ‡å¿—åº”ç”¨å·²å‡†å¤‡å¥½å¯¹å¤–æœåŠ¡                          |
| 2ï¸âƒ£1ï¸âƒ£   | `@EventListener(ContextRefreshedEvent.class)`                | `refresh()` å®Œæˆå                                    | æ³¨æ„ï¼šåœ¨ Web ç¯å¢ƒä¸‹å¯èƒ½è§¦å‘å¤šæ¬¡ï¼ˆçˆ¶å­å®¹å™¨ï¼‰       |
| 2ï¸âƒ£2ï¸âƒ£   | `SmartLifecycle.start()`                                     | `ApplicationReadyEvent` ä¹‹å                          | æŒ‰ `phase` é¡ºåºå¯åŠ¨ï¼Œé€‚åˆåå°çº¿ç¨‹å¯åŠ¨             |
| 2ï¸âƒ£3ï¸âƒ£   | `@EventListener(ApplicationReadyEvent.class)`                | åº”ç”¨å°±ç»ªå                                            | æ¨èç”¨äºæ‰§è¡Œâ€œå¯åŠ¨åâ€é€»è¾‘                          |
| ğŸ›‘    | `SpringApplicationRunListener.failed()`                      | å¯åŠ¨å¤±è´¥æ—¶                                            | ç”¨äºè®°å½•é”™è¯¯ã€æ¸…ç†èµ„æº                            |

---

## ğŸ“Œ è¯¦ç»†è¯´æ˜ä¸ç¤ºä¾‹

### 1. `SpringApplicationRunListener`

```java
public class MyRunListener implements SpringApplicationRunListener {
    public MyRunListener(SpringApplication app, String[] args) { ... }
    @Override public void starting() { ... }
    @Override public void environmentPrepared(ConfigurableBootstrapContext bootstrapContext, ConfigurableEnvironment environment) { ... }
    @Override public void contextPrepared(ConfigurableApplicationContext context) { ... }
    @Override public void started(ConfigurableApplicationContext context) { ... }
    @Override public void ready(ConfigurableApplicationContext context) { ... }
    @Override public void failed(ConfigurableApplicationContext context, Throwable exception) { ... }
}
```

> âš ï¸ éœ€è¦é€šè¿‡ `META-INF/spring.factories` æ³¨å†Œï¼š
>
> ```properties
> org.springframework.boot.SpringApplicationRunListener=com.example.MyRunListener
> ```

---

### 2. `ApplicationContextInitializer`

```java
public class MyContextInitializer implements ApplicationContextInitializer<ConfigurableApplicationContext> {
    @Override
    public void initialize(ConfigurableApplicationContext ctx) {
        // å¯ä¿®æ”¹ Environment
        ctx.getEnvironment().getPropertySources().addFirst(...);
    }
}
```

æ³¨å†Œæ–¹å¼ï¼š

```java
@SpringBootTest
@ContextConfiguration(initializers = MyContextInitializer.class)
class MyTest { }
```

æˆ–åœ¨ `spring.factories` ä¸­ï¼š

```properties
org.springframework.context.ApplicationContextInitializer=com.example.MyContextInitializer
```

---

### 3. `EnvironmentPostProcessor`

```java
public class MyEnvPostProcessor implements EnvironmentPostProcessor {
    @Override
    public void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application) {
        // ä¿®æ”¹ Environment
        environment.getSystemProperties().put("custom.prop", "value");
    }
}
```

æ³¨å†Œæ–¹å¼ï¼ˆ`META-INF/spring.factories`ï¼‰ï¼š

```properties
org.springframework.boot.env.EnvironmentPostProcessor=com.example.MyEnvPostProcessor
```

---

### 4. `ApplicationRunner` / `CommandLineRunner`

```java
@Component
public class MyRunner implements ApplicationRunner {
    @Override
    public void run(ApplicationArguments args) {
        System.out.println("åº”ç”¨å¯åŠ¨åæ‰§è¡Œ");
    }
}
```

> âœ… æ¨èç”¨äºæ•°æ®åˆå§‹åŒ–ã€å¥åº·æ£€æŸ¥ç­‰ã€‚

---

### 5. `SmartLifecycle`

```java
@Component
public class MyService implements SmartLifecycle {
    private boolean running = false;

    @Override
    public void start() {
        // å¯åŠ¨åå°çº¿ç¨‹ç­‰
        running = true;
    }

    @Override
    public void stop() {
        running = false;
    }

    @Override
    public boolean isRunning() {
        return running;
    }

    @Override
    public int getPhase() {
        return 100; // å¯åŠ¨é¡ºåº
    }
}
```

---

## ğŸ§© æ‰§è¡Œé¡ºåºå›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰

```
1. SpringApplicationRunListener.<init>
2. SpringApplicationRunListener.starting()
3. ApplicationContextInitializer.initialize()
4. SpringApplicationRunListener.environmentPrepared()
5. ApplicationEnvironmentPreparedEvent
6. EnvironmentPostProcessor.postProcessEnvironment()
7. SpringApplicationRunListener.contextPrepared()
8. ApplicationContextInitializedEvent
9. Bean å®ä¾‹åŒ–ï¼ˆAware å›è°ƒï¼‰
10. BeanFactoryPostProcessor
11. @Bean æ–¹æ³•æ‰§è¡Œ
12. BeanPostProcessor.postProcessBeforeInitialization
13. @PostConstruct / afterPropertiesSet
14. BeanPostProcessor.postProcessAfterInitialization
15. ApplicationRunner / CommandLineRunner
16. SpringApplicationRunListener.started()
17. ApplicationStartedEvent
18. Web Server Started
19. SpringApplicationRunListener.ready()
20. ApplicationReadyEvent
21. @EventListener(ContextRefreshedEvent)
22. SmartLifecycle.start() (æŒ‰ phase)
23. @EventListener(ApplicationReadyEvent)
```

---

## âœ… æœ€ä½³å®è·µå»ºè®®

| æ‰©å±•ç‚¹                                  | æ¨èç”¨é€”                         |
| --------------------------------------- | -------------------------------- |
| `EnvironmentPostProcessor`              | ä¿®æ”¹é…ç½®ã€æ·»åŠ  PropertySource    |
| `ApplicationContextInitializer`         | ä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼ˆæµ‹è¯•ä¸­å¸¸ç”¨ï¼‰       |
| `ApplicationRunner`                     | å¯åŠ¨åé€»è¾‘ï¼ˆå¦‚æ•°æ®åˆå§‹åŒ–ï¼‰       |
| `SmartLifecycle`                        | åå°æœåŠ¡å¯åŠ¨/åœæ­¢                |
| `@EventListener(ApplicationReadyEvent)` | æ›¿ä»£ `ApplicationRunner`ï¼Œæ›´çµæ´» |
| é¿å…åœ¨ `RunListener` ä¸­åšå¤æ‚é€»è¾‘       | å®ƒå±äºæ¡†æ¶å±‚ï¼Œä¸é€‚åˆä¸šåŠ¡ä»£ç      |

---

## âœ… æ€»ç»“

| é—®é¢˜                         | å›ç­”                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| å“ªä¸ªæ‰©å±•ç‚¹æœ€æ—©ï¼Ÿ             | `SpringApplicationRunListener` æ„é€ å‡½æ•°                      |
| å“ªä¸ªå¯ä»¥ä¿®æ”¹ Environmentï¼Ÿ   | `ApplicationContextInitializer`, `EnvironmentPostProcessor`  |
| å“ªä¸ªé€‚åˆåšæ•°æ®åˆå§‹åŒ–ï¼Ÿ       | `ApplicationRunner`, `@EventListener(ApplicationReadyEvent)` |
| å“ªä¸ªåœ¨ Bean åˆå§‹åŒ–å‰åæ‰§è¡Œï¼Ÿ | `BeanPostProcessor`                                          |
| å“ªä¸ªåœ¨åº”ç”¨å®Œå…¨å°±ç»ªåæ‰§è¡Œï¼Ÿ   | `ApplicationReadyEvent`                                      |

---

æŒæ¡è¿™ä¸ªé¡ºåºï¼Œä½ å°±èƒ½ç²¾å‡†æ§åˆ¶ Spring Boot å¯åŠ¨è¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªç¯èŠ‚ï¼