# K8s网络原理

## 单机容器网络

Linux容器能看见的网络栈，实际上是隔离在他自己的Network Namespace中的。

网络栈包含了：

* 网卡
* 回环设备
* 路由表
* iptables规则

对于一个容器进程来说，网络栈构成了它发起和相应网络请求的基本环境。



既然，每个容器进程都有自己独立的网络栈，那多个容器进程之间如何通信呢？



为了理解上述问题，可以把一个容器想象成一台主机。众所周知，多台主机想要进行网络通信，需要把它们用多根网线连接到一台交换机上。



在Linux中能够起到虚拟交换机作用的网络设备是“网桥”。Docker会默认在宿主机上创建一个docker0的网桥，与docker0连接的容器都可以进行通信。



那么，容器要如何连接到docker0网桥上呢？



容器要连接到docker0网桥上，需要使用一种名叫**Veth Pair**的虚拟设备。

Veth Pair有如下特点：

* 被创建出来后，总是以两种虚拟网卡的形式成对出现。
* 从一张网卡发送的数据包可以直接出现在对应的另一张网卡上，哪怕他们在不同的NetworkNamespae中。

根据Veth Pair的特点，它常被用作连接不同NetworkNamespace的“网线”。



原理：

1. nginx-1容器访问nginx-2容器，比如ping 172.17.0.3。
2. 根据nginx-2的IP地址，匹配nginx-1中的路由规则。





## 跨主机容器网络



### 扩展

网桥

网段

子网

路由表

iptable规则







