

# 领域驱动设计概览

> 软件的核心是其为用户解决领域相关的问题的能力。所有其他特性，不管有多么重要，都要服务于这个基本目的。
>
> ——Eric Evans，《领域驱动设计》



软件复杂度的应对之道提供了一些基本法则，这些基本法则可以说放之四海而皆准，其中一条基本法则就是：*能够控制软件复杂度的，只能是设计（指广泛意义上的设计）方法*。如果我们将软件系统限制在业务软件系统之上，又可得到另外一条基本法则：*要想克服（业务系统的）复杂度，就需要非常严格地使用领域逻辑设计方法*。

在近20年的时间内，一种有效的领域逻辑设计方法就是Eric Evans提出的领域驱动设计(domain-driven design)。

领域驱动设计对软件复杂度的应对，是引入了一套提炼为模式的*设计元模型*，对业务软件系统做到了对规模的控制、结构的清晰化以及对变化的响应。



## 领域驱动设计基本概念

### 元模型想

领域驱动设计元模型是以模式的形式呈现在大家眼前的，由诸多松散的模式构成，这些模式在领域驱动设计中的关系如图2-1所示。

![image-20240128181144728](assets/02.%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A7%88/image-20240128181144728.png)



### 问题空间和解空间

![image-20240128183750831](assets/02.%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A7%88/image-20240128183750831.png)

领域驱动设计为问题空间与解空间提供了不同的设计元模型。

对于问题空间，强调运用统一语言来描述需求问题，利用核心子领域、通用子领域与支撑子领域来分解问题空间，如此就可以“揭示什么是重要的以及在何处付出努力。

除去统一语言与子领域，其余设计元模型都将运用于解空间，指导解决方案围绕着“领域”这一核心开展业务系统的战略设计与战术设计。



### 战略设计和战术设计

不同层次的求解目标并不相同。为了把握系统的全景，就需要从宏观层次分析和探索问题空间，获得对等于软件架构的战略设计原则；为了深入业务的细节，则需要从微观层次开展建模活动，并在战略设计原则的指导下做出战术设计决策。

这就是领域驱动设计的两个阶段：战略设计阶段和战术设计阶段。



### 领域模型驱动设计

模型驱动设计必须在领域驱动设计思维方式的指导下进行，那就是面向领域的模型驱动设计，或者更加准确地将其描述为领域模型驱动设计。

领域模型驱动设计通过单一的领域模型同时满足*分析建模、设计建模和实现建模*的需要，从而将分析、设计和编码实现糅合在一个整体阶段中，避免彼此的分离造成知识传递带来的知识流失和偏差。



## 领域驱动设计过程

领域驱动设计过程是一条若隐若现的由许多点构成的设计轨迹，这些点就是领域驱动设计的设计元模型，如下图所示：

![image-20240128190729745](assets/02.%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A7%88/image-20240128190729745.png)

领域驱动设计的过程几乎贯穿了整个软件构建的生命周期，包括对业务需求的探索和分析，系统的架构和设计，以及编码实现、测试和重构。其基本步骤如下：

1. 面对客户的业务需求，由领域专家与开发团队展开充分的交流。经过需求分析与知识提炼，获得清晰明确的问题空间，并从问题空间的业务需求中提炼出*统一语言*，然后利用子领域分解问题空间，根据价值高低确定核心子领域、通用子领域和支撑子领域。
2. 通过对问题空间开展战略层次的求解，获得限界上下文形成解空间的主要支撑元素。识别限界上下文的基础来自问题空间的业务需求，遵循“高内聚松耦合”的原则划分领域知识的边界，再通过上下文映射管理它们之间的关系。每个限界上下文都是一个相对独立的“自治王国”，可以根据限界上下文是否属于核心子领域来选择内部的架构。通常，需要通过分层架构将限界上下文内部的领域隔离出来，进入战术设计阶段，进行面向领域的模型驱动设计。
3. 选定一个限界上下文，在统一语言的指导下，针对该上下文内部的领域知识开展领域模型驱动设计。首先进行领域分析，提炼领域知识建立满足统一语言要求的领域分析模型，然后引入实体、值对象、领域服务、领域事件、聚合、资源库和工厂等设计要素开始程序设计，获得设计模型后在它的指导下进行编码实现，输出最终的领域模型。

在领域驱动设计过程中，战略设计控制和分解了战术设计的边界与粒度，战术设计则以实证角度验证领域模型的有效性、完整性和一致性，进而以迭代的方式分别完成对限界上下文与领域模型的更新与演化，各自形成设计过程的闭环。两个不同阶段的设计目标保持一致，形成一个连贯的过程，彼此之间相互指导与规范，最终保证战略架构与领域模型的同时演进。



## 控制软件复杂度

### 控制规模

领域驱动设计提出了两个重要的设计元模型：限界上下文和上下文映射，它们是控制系统规模最为有效的手段，也是领域驱动设计战略设计阶段的核心模式。



### 清晰结构

领域驱动设计通过限界上下文隔离了业务能力的边界，通过分层架构隔离了业务逻辑与技术实现，如此就能保证整个业务系统的架构具有清晰的结构，实现了有序设计，可以避免不同关注点的代码混杂在一处，形成可怕的“大泥球”。



### 响应变化



## 冷静认识

控制软件复杂度是构建软件过程中永恒的旋律，必须明确：软件复杂度可以控制，但不可消除。领域驱动设计控制软件复杂度的中心主要在于“领域”，Eric Evans就认为：“很多应用程序最主要的复杂度并不在技术上，而是来自领域本身、用户的活动或业务。”[插图]2这当然并不全面，随着软件的“触角”已经蔓延到人类生活的方方面面，在业务复杂度变得越来越高的同时，技术复杂度也在不断地向技术极限发起挑战，其制造的技术障碍完全不亚于业务层面带来的困难。

*领域驱动设计并非“银弹”，它的适用范围主要是大规模的、具有复杂业务的中大型软件系统，至于对技术复杂度的应对，它的选择是“隔离”，然后交给专门的技术团队设计合理的解决方案。*

